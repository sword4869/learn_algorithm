## é‡è¦

é¦–å…ˆï¼Œè¦æ±‚æ•°ç»„æœ‰åºã€‚

**target < nums[m] < targetï¼Œtargetåœ¨ä¸­é—´å…ƒç´ nums[m]çš„ä¸¤è¾¹**ã€‚

1. åŸºç¡€ç‰ˆå’Œæ”¹åŠ¨ç‰ˆï¼šåŒºåˆ«å°±æ˜¯**å·¦é—­å³é—­**ã€å·¦é—­å³å¼€ã€‚

     - **j = n -1** , j = n
     - **while(i<=j)**, while(i<j)
     - **j = m- 1**, j = m

2. åŸºç¡€ç‰ˆçš„å¤æ‚åº¦

    æ—¶é—´å¤æ‚åº¦
    * æœ€åæƒ…å†µï¼š$O(\log n)$
    * æœ€å¥½æƒ…å†µï¼šå¦‚æœå¾…æŸ¥æ‰¾å…ƒç´ æ°å¥½åœ¨æ•°ç»„ä¸­å¤®ï¼Œåªéœ€è¦å¾ªç¯ä¸€æ¬¡ $O(1)$
    
    ç©ºé—´å¤æ‚åº¦
    * éœ€è¦å¸¸æ•°ä¸ªæŒ‡é’ˆ $i,j,m$ï¼Œå› æ­¤é¢å¤–å ç”¨çš„ç©ºé—´æ˜¯ $O(1)$ 

3. leftmostå’Œrightmostçš„æ ‡å‡†ç‰ˆï¼šæ‰¾ä¸åˆ°è¿”å›-1

    - leftmost: æ‰¾åˆ°äº†å¾€å·¦ç§»ï¼Œ j = m - 1
    - rightmost: æ‰¾åˆ°äº†å¾€å³ç§»ï¼Œ i = m + 1
4. leftmostå’Œrightmostçš„æ›¿èº«ç‰ˆï¼šæ‰¾ä¸åˆ°è¿”å›æ›¿èº«

    - leftmostï¼šå¤§äºç­‰äºçš„æœ€å·¦ `target <= a[m]`, i
    - rightmostï¼šå°äºç­‰äºçš„æœ€å³ `a[m] <= target`ï¼Œi-1

### åŸºç¡€ç‰ˆï¼šijéƒ½æŸ¥ 

å…ƒç´ åœ¨æœ€å·¦è¾¹ L æ¬¡ï¼Œ å…ƒç´ åœ¨æœ€å³è¾¹ 2L æ¬¡
```java
// 704. äºŒåˆ†æŸ¥æ‰¾
class Solution {
    public int search(int[] nums, int target) {
        int i = 0, j = nums.length - 1;
        while (i <= j) {                // [i,j] èŒƒå›´å†…æœ‰ä¸œè¥¿
            int m = (i + j) >>> 1;      /// (i+j)/2çš„å‘ä¸‹å–æ•´
            if (target < nums[m]) {             // ç›®æ ‡åœ¨å·¦è¾¹
                j = m - 1;
            } else if (nums[m] < target){       // ç›®æ ‡åœ¨å³è¾¹
                i = m + 1;
            } else{                             // æ‰¾åˆ°äº†
                return m;
            }
        }
        return -1;
        // è¿”å›å°†ä¼šè¢«æŒ‰é¡ºåºæ’å…¥çš„ä½ç½®ã€‚
        //      return i;         ç›´æ¥å†™æ³•
        //      return -(i + 1);  javaåº•å±‚å†™æ³•
    }
}
```

æ’å…¥ä½ç½®ä¸º `i`: äºŒåˆ†ç»“æŸæ—¶ä¸€å®šæœ‰ï¼Œi æŒ‡å‘é¦–ä¸ªå¤§äº `target` çš„å…ƒç´ ï¼Œj æŒ‡å‘é¦–ä¸ªå°äº `target` çš„å…ƒç´ ã€‚

### Leftmost ä¸ Rightmostçš„-1ç‰ˆæœ¬

è¿”å›çš„æ˜¯æœ€å·¦ä¾§çš„é‡å¤å…ƒç´  / è¿”å›çš„æ˜¯æœ€å³ä¾§çš„é‡å¤å…ƒç´ ï¼Œæ²¡æ‰¾åˆ°åˆ™è¿”å›-1.

leftmostï¼šæœ¬æ¥ä¸­é—´ç´¢å¼•må¤„æ‰¾åˆ°äº†ï¼Œä½†æ˜¯è¿˜å¾€å·¦æ‰¾ï¼ˆç§»åŠ¨jå‘å·¦ `j = m - 1`ï¼‰

```java
/**
 * <h3>äºŒåˆ†æŸ¥æ‰¾ Leftmost </h3>
 * @return <p>æ‰¾åˆ°åˆ™è¿”å›æœ€é å·¦ç´¢å¼•</p>
 * <p>æ‰¾ä¸åˆ°è¿”å› -1</p>
 */
public static int binarySearchLeftmost(int[] a, int target) {
    int i = 0, j = a.length - 1;
    int candidate = -1;
    while (i <= j) {
        int m = (i + j) >>> 1;
        if (target < a[m]) {
            j = m - 1;
        } else if (a[m] < target) {
            i = m + 1;
        } else {
            candidate = m; // è®°å½•å€™é€‰ä½ç½®
            j = m - 1;     // ç»§ç»­å‘å·¦
        }
    }
    return candidate;
}
```
```java
/**
 * <h3>äºŒåˆ†æŸ¥æ‰¾ Rightmost </h3>
 * @return <p>æ‰¾åˆ°åˆ™è¿”å›æœ€é å³ç´¢å¼•</p>
 * <p>æ‰¾ä¸åˆ°è¿”å› -1</p>
 */
public static int binarySearchRightmost(int[] a, int target) {
    int i = 0, j = a.length - 1;
    int candidate = -1;
    while (i <= j) {
        int m = (i + j) >>> 1;
        if (target < a[m]) {
            j = m - 1;
        } else if (a[m] < target) {
            i = m + 1;
        } else {
            candidate = m; // è®°å½•å€™é€‰ä½ç½®
            i = m + 1;	   // ç»§ç»­å‘å³
        }
    }
    return candidate;
}
```
### Leftmost ä¸ Rightmost çš„i/jç‰ˆ

å¦‚æœæ²¡æ‰¾åˆ°ï¼Œå¯ä»¥è¿”å›ä¸€ä¸ªæ¯” -1 æ›´æœ‰ç”¨çš„ç´¢å¼•ã€‚

å³ï¼šleftmost æ‰¾åˆ°å¤§äºç­‰äºç›®æ ‡çš„æœ€å·¦å…ƒç´ çš„ç´¢å¼•ï¼ˆä¸‹ç•Œï¼‰ï¼Œrightmost æ‰¾åˆ°å°äºç­‰äºç›®æ ‡çš„æœ€å³å…ƒç´ çš„ç´¢å¼•ï¼ˆä¸Šç•Œï¼‰

1. ç®€åŒ–ï¼šä¸ç”¨è®°å½•`candidate`ï¼Œåˆ™ç›´æ¥å»æ‰`candidate = m; // è®°å½•å€™é€‰ä½ç½®`è¿™ä¸€è¡Œã€‚å‰©ä¸‹`i = m + 1;`å¯ä»¥åˆå¹¶åˆ°ä¸Šé¢çš„if-elseä¸­ã€‚
2. return è¿”å›çš„å«ä¹‰å˜åŒ–ï¼šleftmost æ‰¾åˆ°å¤§äºç­‰äºç›®æ ‡çš„æœ€å·¦å…ƒç´  `return i`ï¼Œrightmost æ‰¾åˆ°å°äºç­‰äºç›®æ ‡çš„æœ€å³å…ƒç´  `return i-1`

![alt text](../../images/image-90.png)


æ³¨æ„è¿”å›å€¼è¶…å‡ºæ•°ç»„çš„æƒ…å†µï¼šleft `[0, n]`, right `[-1, n-1]`
- å¦‚æœtargetå°äºæœ€å°çš„ï¼Œleft è¿”å› 0ï¼Œrightmostè¿”å› **-1**
- å¦‚æœtargetå¤§äºæœ€å¤§çš„ï¼Œleft è¿”å› **n**ï¼Œrightmostè¿”å› n-1
```java
public static int binarySearchLeftmostUseful(int[] a, int target) {
    int i = 0, j = a.length - 1;
    while (i <= j) {
        int m = (i + j) >>> 1;
        if (target <= a[m]) {
            j = m - 1;
        } else {
            i = m + 1;
        }
    }
    return i;   // return j + 1;
}
å¾ªç¯å®Œæˆåï¼Œi æŒ‡å‘æœ€å·¦è¾¹çš„ target ï¼Œj æŒ‡å‘é¦–ä¸ªå°äº target çš„å…ƒç´ ã€‚

public static int binarySearchRightmostUseful(int[] a, int target) {
    int i = 0, j = a.length - 1;
    while (i <= j) {
        int m = (i + j) >>> 1;
        if (target < a[m]) {
            j = m - 1;
        } else {
            i = m + 1;
        }
    }
    return j;	// return i - 1;
}
å¾ªç¯å®Œæˆåï¼Œi æŒ‡å‘é¦–ä¸ªå¤§äº target çš„å…ƒç´  ï¼Œj æŒ‡å‘æœ€å³è¾¹çš„ targetã€‚
```

> å››ç§äº’ç›¸è½¬åŒ–

`>= x`  æ˜¯ leftmost(x)

`> x` æ˜¯ `>= x+1`

`< x` æ˜¯ `(>=x) - 1`

`<= x`  æ˜¯ rightmost(x), ä¹Ÿæ˜¯`(>x) - 1` å³ `(>= x+1) -1`

### é€’å½’ç‰ˆ

æ‹†è§£ while å¾ªç¯ã€‚

```java
/**
 * <h3>äºŒåˆ†æŸ¥æ‰¾ é€’å½’ç‰ˆ </h3>
 * @return <p>æ‰¾åˆ°åˆ™è¿”å›ç´¢å¼•</p>
 * <p>æ‰¾ä¸åˆ°è¿”å› -1</p>
 */
public static int binarySearchRecursion(int[] a, int target){
    return recursion(a, target, 0, a.length - 1);
}

public static int recursion(int[] a, int target, int i, int j){
    if(i > j){
        return -1;
        // return i;
    }

    int m = (i + j) >>> 1;

    if (target < a[m]){
        return recursion(a, target, i, m - 1);
    }else if(a[m] < target){
        return recursion(a, target, m + 1, j);
    }else{
        return m;
    }
}
```

## æ—¶é—´å¤æ‚åº¦

äºŒå‰æœç´¢æ ‘çš„æŸ¥æ‰¾æ“ä½œä¸äºŒåˆ†æŸ¥æ‰¾ç®—æ³•çš„å·¥ä½œåŸç†ä¸€è‡´ï¼Œéƒ½æ˜¯æ¯è½®æ’é™¤ä¸€åŠæƒ…å†µã€‚å¾ªç¯æ¬¡æ•°æœ€å¤šä¸ºäºŒå‰æ ‘çš„é«˜åº¦ï¼Œå½“äºŒå‰æ ‘å¹³è¡¡æ—¶ï¼Œä½¿ç”¨ ğ‘‚(logâ¡ğ‘›) æ—¶é—´



12ä¸ªå…ƒç´ çš„æ’åºæ•°ç»„è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼Œæ¯ä¸ªå…ƒç´ è¢«æŸ¥æ‰¾çš„æ¦‚ç‡æ˜¯ç›¸ç­‰çš„ï¼Œåˆ™å¹³å‡æ¯”è¾ƒæ¬¡æ•°æ˜¯ï¼Ÿ37/12

â€‹	$æŸ¥æ‰¾æ¬¡æ•°/å…ƒç´ ä¸ªæ•°=1*1+2*2+3*4+4*5$ã€‚ç”»ä¸€ä¸ªäºŒå‰æ ‘ï¼Œç¬¬iå±‚å°±è¦æ¯”è¾ƒici

## leetcode

### æœç´¢æ’å…¥ä½ç½®
åŸºç¡€ç‰ˆ
```java
class Solution {
    public int searchInsert(int[] nums, int target) {
        int i = 0, j = nums.length - 1;
        while (i <= j) {
            int m = (i + j) >>> 1;
            if (target < nums[m]) {
                j = m - 1;
            } else if (nums[m] < target) {
                i = m + 1;
            } else {
                return m;
            }
        }
        return i;
    }
}
```
### leftmost -1ç‰ˆ

```java
// 278. ç¬¬ä¸€ä¸ªé”™è¯¯çš„ç‰ˆæœ¬
public class Solution extends VersionControl {
    public int firstBadVersion(int n) {
        // [1...n] æ˜¯é¢˜ç›®çš„èŒƒå›´ï¼Œiå’Œjçš„æœ¬è´¨åªæ˜¯åˆ’å®šèŒƒå›´
        int i = 1, j = n;
        while (i <= j) {
            int m = (i + j) >>> 1;
            // isBadVersionå…¶å®å°±æ˜¯æ±‚leftmost
            if (isBadVersion(m)) { // ç›®æ ‡åœ¨å·¦è¾¹
                j = m - 1;
            } else {
                i = m + 1;
            }
        }
        return i;
    }
}
```

### leftmost rightmost -1ç‰ˆ
```java
// 34. åœ¨æ’åºæ•°ç»„ä¸­æŸ¥æ‰¾å…ƒç´ çš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªä½ç½®
class Solution {
    public int[] searchRange(int[] nums, int target) {
        return new int[] { leftmost(nums, target), rightmost(nums, target) };
    }

    public static int leftmost(int[] nums, int target) {
        int i = 0, j = nums.length - 1;
        int res = -1;
        while (i <= j) {
            int m = (i + j) >>> 1;
            if (target < nums[m]) {
                j = m - 1;
            } else if (nums[m] < target) {
                i = m + 1;
            } else {
                j = m - 1;
                res = m;
            }
        }
        return res;
    }

    public static int rightmost(int[] nums, int target) {
        int i = 0, j = nums.length - 1;
        int res = -1;
        while (i <= j) {
            int m = (i + j) >>> 1;
            if (target < nums[m]) {
                j = m - 1;
            } else if (nums[m] < target) {
                i = m + 1;
            } else {
                i = m + 1;
                res = m;
            }
        }
        return res;
    }
}
```

### leftmost i rightmost j


```java
// åªç”¨leftmostå®ç°
// 34. åœ¨æ’åºæ•°ç»„ä¸­æŸ¥æ‰¾å…ƒç´ çš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªä½ç½®
class Solution {
    public int[] searchRange(int[] nums, int target) {
        int left = leftmost(nums, target);
        if(left == nums.length || nums[left] != target){	// æ‰¾åˆ°çš„ä¸æ˜¯ï¼Œæˆ–è€…è¶…è¿‡æœ€å¤§ã€‚æ³¨æ„å‰åé¡ºåº
            return new int[]{-1, -1};
        }
        return new int[] {left, leftmost(nums, target + 1) -1};	// rightmost(i) = leftmost(i+1) - 1
    }

    public static int leftmost(int[] nums, int target) {
        int i = 0, j = nums.length - 1;
        while (i <= j) {
            int m = (i + j) >>> 1;
            if (target < nums[m]) {
                j = m - 1;
            } else if (nums[m] < target) {
                i = m + 1;
            } else {
                j = m - 1;
            }
        }
        return i;
    }
}
```

```java
class Solution {
    public int[] searchRange(int[] nums, int target) {
        int right = rightmost(nums, target);
        if (right == -1 || nums[right] != target) {
            return new int[] { -1, -1 };
        }
        return new int[] { rightmost(nums, target - 1) + 1, right };
    }

    public int rightmost(int[] nums, int target) {
        int i = 0, j = nums.length - 1;
        while (i <= j) {
            int m = (i + j) >>> 1;
            if (target < nums[m]) {
                j = m - 1;
            } else {
                i = m + 1;
            }
        }
        return j;
    }
}
```

