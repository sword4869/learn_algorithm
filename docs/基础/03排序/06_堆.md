[toc]

## å †

### åŸºæœ¬æ¦‚å¿µ

**å¤§é¡¶å †å †é¡¶æœ€å¤§ï¼Œå°é¡¶å †å †é¡¶æœ€å°**ã€‚**è€Œä¸èƒ½ä¿è¯å †çš„å·¦å³å­æ ‘æ˜¯æœ‰åºçš„**

* åœ¨å¤§é¡¶å †ä¸­ï¼Œä»»æ„çˆ¶èŠ‚ç‚¹çš„å€¼ >= å­èŠ‚ç‚¹çš„å€¼
* è€Œå°é¡¶å †ä¸­ï¼Œä»»æ„çˆ¶èŠ‚ç‚¹çš„å€¼ <= å­èŠ‚ç‚¹çš„å€¼



å †ä½¿ç”¨çš„æ˜¯**å®Œå…¨äºŒå‰æ ‘**ï¼ˆä»ç´¢å¼• 0 å¼€å§‹å­˜å‚¨èŠ‚ç‚¹æ•°æ®ï¼‰
* èŠ‚ç‚¹ $i$ çš„å·¦å­èŠ‚ç‚¹ä¸º $2i+1$ï¼Œå³å­èŠ‚ç‚¹ä¸º $2i+2$ã€‚ã€æ ¹èŠ‚ç‚¹0ï¼Œå·¦å³å­èŠ‚ç‚¹1å’Œ2ï¼Œ2iå¿…æœ‰ï¼Œç›´æ¥+1ã€+2ã€‘

* èŠ‚ç‚¹ $i$ çš„çˆ¶èŠ‚ç‚¹ä¸º $(i-1)/2$ å‘ä¸‹å–æ•´ã€‚ ã€2i+2å…ˆÃ·2å†-1å¯ä»¥ï¼Œå½“2i+1å°±ä¼šå°‘ä¸€ä¸ªã€‘

* éå¶å­èŠ‚ç‚¹èŒƒå›´ä¸º $[0, size/2-1]$

  â€‹	æœ€åä¸€ä¸ªå¶èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ï¼Œå³ä¸ºæœ€åä¸€ä¸ªéå¶å­èŠ‚ç‚¹ã€‚

  â€‹	æœ€åèŠ‚ç‚¹çš„ä¸‹æ ‡æ˜¯ size-1ï¼Œåˆ™çˆ¶èŠ‚ç‚¹ä¸º (size-1-1)/2 = size/2-1


![ä¸é‡è¦](https://www.hello-algo.com/chapter_heap/heap.assets/min_heap_and_max_heap.png)

### å»ºå †

#### å¨å»‰å§†æ–¯ç®—æ³•: ä¸Šæµ®

O($n\log n$)

è‡ªä¸Šè€Œä¸‹ã€‚næ¬¡å¾ªç¯ * lognçš„æ’å…¥ä¸Šæµ®

```java
// 215. æ•°ç»„ä¸­çš„ç¬¬Kä¸ªæœ€å¤§å…ƒç´ 
class Solution {
    public int findKthLargest(int[] nums, int k) {
        MaxHeap heap = new MaxHeap(nums.length);
        for(int num: nums){
            heap.offer(num);
        }
    }

    static class MaxHeap {
        public int[] nums;
        public int size;

        public MaxHeap(int capacity) {
            nums = new int[capacity];
        }

        public void offer(int num) {
            nums[size] = num;
            up(size);
            size++;
        }

        private void up(int child){
            int parent = (child - 1 ) / 2;
            if(parent >= 0 && nums[parent] < nums[child]){
                swap(child, parent);
                up(parent);
            }
        }

        private void swap(int i, int j) {
            int temp = nums[i];
            nums[i] = nums[j];
            nums[j] = temp;
        }
    }
}
```



#### ğŸš€Floyd: ä¸‹æ½œ

O(n)

è‡ªä¸‹è€Œä¸Šã€‚ä»æœ€åä¸€ä¸ªéå¶å­ç»“ç‚¹(size/2 - 1)å¾€0ç´¢å¼•ï¼Œå¯¹æ¯ä¸ªèŠ‚ç‚¹ä¸‹æ½œ

æ—¶é—´å¤æ‚åº¦ O(n)

â€‹	éœ€è¦äº¤æ¢$2^h -h -1$æ¬¡([8.2  å»ºå †æ“ä½œ - Hello ç®—æ³• (hello-algo.com)](https://www.hello-algo.com/chapter_heap/build_heap/#823))ï¼Œå…¶ä¸­ $2^h \approx n$ï¼Œ$h \approx \log_2{n}$


```java
// 215. æ•°ç»„ä¸­çš„ç¬¬Kä¸ªæœ€å¤§å…ƒç´ 
class Solution {
    public int findKthLargest(int[] nums, int k) {
        MaxHeap heap = new MaxHeap(nums);
    }

    static class MaxHeap {
        public int[] nums;
        public int size;

        public MaxHeap(int[] nums) {
            this.nums = nums;
            this.size = nums.length;
            buildHeap();
        }

        private void buildHeap() {
            for (int i = size / 2 - 1; i >= 0; i--) {
                down(i);
            }
        }

        private void down(int parent) {
            int left = 2 * parent + 1;
            int right = left + 1;
            int max = parent;
            if (left < size && nums[left] > nums[max]) {
                max = left;
            }
            if (right < size && nums[right] > nums[max]) {
                max = right;
            }
            if (max != parent) {
                swap(max, parent);
                down(max);
            }
        }

        private void swap(int i, int j) {
            int temp = nums[i];
            nums[i] = nums[j];
            nums[j] = temp;
        }
    }
}
```

### å¤§å°é¡¶å †

å°é¡¶å †ï¼Œåªéœ€è¦æ”¹downã€up çš„è§„åˆ™ã€‚å»ºå †ã€å‡ºå †ã€å…¥å †ä¸å˜ã€‚

â€‹	maxæ¢ä¸ªåå­—min

â€‹	 `nums[left] < nums[min]` , 	 `nums[right] < nums[min]` 

### ä¸‹æ½œ down

æ¶‰åŠ

- å»ºå †Floyd

- å¼¹å‡ºå…ƒç´  poll

```java
// å¤§é¡¶å †çš„ä¸‹æ½œ
private void down(int parent) {
    // parentè‡ªèº«å’Œå·¦å³å­©å­left,right
    int left = parent * 2 + 1;
    int right = left + 1;
    // é€‰å‡ºæœ€å¤§å€¼çš„ç´¢å¼•ä¸ºmax
    int max = parent;
    // å­©å­å¯èƒ½è¶…å‡ºé€’å½’è¾¹ç•Œï¼Œæ‰€ä»¥ < size
    if (left < size && nums[left] > nums[max]) {
        max = left;
    }
    if (right < size && nums[right] > nums[max]) {
        max = right;
    }
    
    // å¦‚æœmaxä¸ºå­©å­ï¼Œæ‰äº¤æ¢ï¼Œç»§ç»­é€’å½’
    if (max != parent) {
        swap(max, parent);
        // æ˜¯é€’å½’å­©å­
        down(max);		
    }
}
```

```java
// å¾ªç¯
private void down(int parent) {
    while (true) {
        int left = parent * 2 + 1;
        int right = left + 1;
        int max = parent;
        if (left < size && nums[left] > nums[max]) {
            max = left;
        }
        if (right < size && nums[right] > nums[max]) {
            max = right;
        }
        if (max != parent) {
            swap(max, parent);
            parent = max;
        } else {
            break;
        }
    }
}
```

### ä¸Šæµ® up

æ¶‰åŠï¼š

- å»ºå †å¨å»‰å§†æ–¯ç®—æ³•
- æ’å…¥å…ƒç´  offer

```java
// å¤§é¡¶å †çš„ä¸Šæµ®
private void up(int child){
    int parent = (child - 1 ) / 2;
    if(parent >= 0 && nums[parent] < nums[child]){
        swap(child, parent);
        up(parent);
    }
}
```

### æ’å…¥å…ƒç´  offer

1. æ·»åŠ å…ƒç´ çš„ä½ç½®ä¸º`nums[size]`

   â€‹	è‚¯å®šæ’å…¥åˆ°æœ«å°¾ï¼Œä¸ç„¶æ›¿æ¢å †é¡¶åˆ°å“ªé‡Œå»

2. ä¸Šæµ®

   â€‹	**éœ€è¦ä¿®å¤ä»æ’å…¥èŠ‚ç‚¹åˆ°æ ¹èŠ‚ç‚¹çš„è·¯å¾„ä¸Šçš„å„ä¸ªèŠ‚ç‚¹**

```java
public void offer(int num) {
    nums[size] = num;
    up(size);
    size++;
}
```

### å¼¹å‡ºå…ƒç´  poll

```java
public int poll() {
    int top = nums[0];		// è®°å½•å †é¡¶
    
    // (1)äº¤æ¢ï¼šäº¤æ¢å †é¡¶å’Œæœ€åä¸€ä¸ªå…ƒç´ 
    swap(0, size - 1);
    // (2)size--ï¼šè¡¨ç¤ºåˆ é™¤å…ƒç´ 
    size--;
    // (3)ä¸‹æ½œï¼šé‡æ–°ä¸‹æ½œå †é¡¶ 
    down(0);
    
    return top;
}
```

## å †æ’åº

å‡åºå»ºç«‹å¤§é¡¶å †ï¼ˆå¼¹å‡ºåˆ°å †å°¾ï¼‰ï¼Œé™åºæ˜¯å°é¡¶å †ã€‚



è¿‡ç¨‹ï¼š

â€‹	ï¼ˆ1ï¼‰å»ºå¤§é¡¶å †

â€‹		ä»æœ€åä¸€ä¸ªéå¶å­ç»“ç‚¹(size/2 - 1)å¾€0ç´¢å¼•ï¼Œå¯¹æ¯ä¸ªèŠ‚ç‚¹ä¸‹æ½œ 

â€‹	ï¼ˆ2ï¼‰å‡ºå †é¡¶ç›´åˆ°å‰©ä¸€ä¸ª

â€‹		äº¤æ¢ï¼šäº¤æ¢å †é¡¶å’Œæœ€åä¸€ä¸ªå…ƒç´ 

â€‹		size--ï¼šè¡¨ç¤ºåˆ é™¤å…ƒç´ 

â€‹		ä¸‹æ½œï¼šé‡æ–°ä¸‹æ½œå †é¡¶

â€‹	ï¼ˆ3ï¼‰å¾—åˆ°å‡åºæ•°ç»„ã€‚ 



æ—¶é—´å¤æ‚åº¦ï¼šO(nlogn)

1. å»ºå †ï¼šFloydå †æ„å»ºç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(n)ã€‚(å¨å»‰å§†æ–¯å †æ„å»ºç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(nlogn))

2. è°ƒæ•´å †ï¼šO(nlogn)ã€‚

   â€‹	è¿™ä¸ªè¿‡ç¨‹æ˜¯æŠŠå †é¡¶å…ƒç´ ä¸å †çš„æœ€åä¸€ä¸ªå…ƒç´ äº¤æ¢ï¼Œç„¶åæŠŠå‰©ä¸‹çš„å…ƒç´ è°ƒæ•´ä¸ºä¸€ä¸ªæ–°çš„å †ã€‚è¿™ä¸ªè¿‡ç¨‹éœ€è¦è¿›è¡Œn-1æ¬¡

   â€‹	æ¯æ¬¡å‡ºå †çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(logn)





### ğŸš€å®Œæ•´å†™æ³•

```java
// 912. æ’åºæ•°ç»„
class Solution {
    public int[] sortArray(int[] nums) {
        // å»ºç«‹å¤§é¡¶å †
        MaxHeap heap = new MaxHeap(nums);
        // å‡ºå †
        for(int i= 0; i < nums.length - 1; i++){
            heap.poll();
        }
        return nums;
    }

    static class MaxHeap {
        int[] nums;
        int size;

        public MaxHeap(int[] nums) {
            this.nums = nums;
            this.size = nums.length;
            buildHeap();
        }

        private void buildHeap() {
            for (int i = size / 2 - 1; i >= 0; i--) {
                down(i);
            }
        }

        private void down(int parent) {
            int left = 2 * parent + 1;
            int right = left + 1;
            int max = parent;
            if (left < size && nums[left] > nums[max]) {
                max = left;
            }
            if (right < size && nums[right] > nums[max]) {
                max = right;
            }
            if (max != parent) {
                swap(max, parent);
                down(max);
            }
        }

        private void swap(int i, int j) {
            int temp = nums[i];
            nums[i] = nums[j];
            nums[j] = temp;
        }
        
        public int poll() {
            int top = nums[0];
            
            swap(0, size - 1);
            size--;
            down(0);
            
            return top;
        }
    }
}
```

### ç®€åŒ–å†™æ³•

```java
/* å †çš„é•¿åº¦ä¸º n ï¼Œä»èŠ‚ç‚¹ i å¼€å§‹ï¼Œä»é¡¶è‡³åº•å †åŒ– */
void siftDown(int[] nums, int n, int i) {
    while (true) {
        // åˆ¤æ–­èŠ‚ç‚¹ i, l, r ä¸­å€¼æœ€å¤§çš„èŠ‚ç‚¹ï¼Œè®°ä¸º ma
        int l = 2 * i + 1;
        int r = 2 * i + 2;
        int ma = i;
        if (l < n && nums[l] > nums[ma])
            ma = l;
        if (r < n && nums[r] > nums[ma])
            ma = r;
        // è‹¥èŠ‚ç‚¹ i æœ€å¤§æˆ–ç´¢å¼• l, r è¶Šç•Œï¼Œåˆ™æ— é¡»ç»§ç»­å †åŒ–ï¼Œè·³å‡º
        if (ma == i)
            break;
        // äº¤æ¢ä¸¤èŠ‚ç‚¹
        int temp = nums[i];
        nums[i] = nums[ma];
        nums[ma] = temp;
        // å¾ªç¯å‘ä¸‹å †åŒ–
        i = ma;
    }
}

/* å †æ’åº */
void heapSort(int[] nums) {
    // å»ºå †æ“ä½œï¼šå †åŒ–é™¤å¶èŠ‚ç‚¹ä»¥å¤–çš„å…¶ä»–æ‰€æœ‰èŠ‚ç‚¹
    for (int i = nums.length / 2 - 1; i >= 0; i--) {
        siftDown(nums, nums.length, i);
    }
    // ä»å †ä¸­æå–æœ€å¤§å…ƒç´ ï¼Œå¾ªç¯ n-1 è½®
    for (int i = nums.length - 1; i > 0; i--) {
        // äº¤æ¢æ ¹èŠ‚ç‚¹ä¸æœ€å³å¶èŠ‚ç‚¹ï¼ˆäº¤æ¢é¦–å…ƒç´ ä¸å°¾å…ƒç´ ï¼‰
        int tmp = nums[0];
        nums[0] = nums[i];
        nums[i] = tmp;
        // ä»¥æ ¹èŠ‚ç‚¹ä¸ºèµ·ç‚¹ï¼Œä»é¡¶è‡³åº•è¿›è¡Œå †åŒ–
        siftDown(nums, i, 0);
    }
}
```

## æ—¶é—´å¤æ‚åº¦

å»ºå †ï¼šFloyd O(n), å¨å»‰å§†æ–¯ç®—æ³• O(nlogn)

å…¥å †å’Œå‡ºå †æ“ä½œçš„æ—¶é—´å¤æ‚åº¦å‡ä¸º ğ‘‚(logâ¡ğ‘›) 

å †æ’åº: O(nlogn)

## PriorityQueue

å †é€šå¸¸ç”¨äºå®ç°ä¼˜å…ˆé˜Ÿåˆ—ï¼Œå¤§é¡¶å †ç›¸å½“äºå…ƒç´ æŒ‰ä»å¤§åˆ°å°çš„é¡ºåºå‡ºé˜Ÿçš„ä¼˜å…ˆé˜Ÿåˆ—

```java
// é»˜è®¤å°±æ˜¯å°é¡¶å †
PriorityQueue<Integer> q = new PriorityQueue<>();
// å¤§é¡¶å †
PriorityQueue<Integer> q = new PriorityQueue<>((a, b) -> b - a);

q.offer(nums[i]);
int size = q.size();
int peek = q.peek();
int poll = q.poll();
boolean isEmpty = maxHeap.isEmpty();
```