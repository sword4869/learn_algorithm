## å½’å¹¶æ’åº

![å½’å¹¶æ’åºçš„åˆ’åˆ†ä¸åˆå¹¶é˜¶æ®µ](https://www.hello-algo.com/chapter_sorting/merge_sort.assets/merge_sort_overview.png)



### ğŸš€é€’å½’ï¼šè‡ªé¡¶å‘ä¸‹

```
[5,1,1,2,0,0]
[5,1,1] [2,0,0]     // è€Œè‡ªåº•å‘ä¸Šæ˜¯ [5,1] [1,2] [0,0]
[5,1] [1] [2,0] [0]
[5] [1] [1] [2] [0] [0]
```
ğŸš€é¢å¤–æ•°ç»„æ¯æ¬¡åˆ†é…

```java
class Solution {
    public int[] sortArray(int[] nums) {
        mergeSort(nums, 0, nums.length - 1);
        return nums;
    }

    public void mergeSort(int[] nums, int i, int j) {
        if (i >= j) {   // i==jå°±è¡Œï¼Œå½“å­æ•°ç»„é•¿åº¦ä¸º 1 æ—¶ç»ˆæ­¢é€’å½’ã€‚ä½†æœ‰çš„å‚»é€¼é¢˜ï¼Œä¼ ç©ºæ•°ç»„ï¼Œj = -1ï¼Œé‚£ä¹ˆå°± i>=j
            return;
        }
        int m = i + j >>> 1;
        mergeSort(nums, i, m);
        mergeSort(nums, m + 1, j);
        // å†ä»åº•å‘ä¸Šåˆå¹¶
        merge(nums, i, m, j);
    }

    public void merge(int[] nums, int i, int m, int j) {
        int[] temps = new int[j - i + 1];
        int p1 = i, p2 = m + 1, p = 0;
        while (p1 <= m && p2 <= j) {
            if (nums[p1] <= nums[p2]) {
                temps[p++] = nums[p1++];
            } else {
                temps[p++] = nums[p2++];
            }
        }
        if (p1 <= m) {
            System.arraycopy(nums, p1, temps, p, m - p1 + 1);
        } else {
            System.arraycopy(nums, p2, temps, p, j - p2 + 1);
        }
        System.arraycopy(temps, 0, nums, i, j - i + 1);
    }
}
```


é¢å¤–æ•°ç»„å…¬ç”¨

```java
class Solution {
    public int[] sortArray(int[] nums) {
        int[] t = new int[nums.length];
        mergeSort(nums, 0, nums.length - 1, t);
        return nums;
    }

    public void mergeSort(int[] nums, int i, int j, int[] t) {
        if (i == j) {   // å½“å­æ•°ç»„é•¿åº¦ä¸º 1 æ—¶ç»ˆæ­¢é€’å½’
            return;
        }
        int m = i + j >>> 1;
        mergeSort(nums, i, m, t);
        mergeSort(nums, m + 1, j, t);
        // å†ä»åº•å‘ä¸Šåˆå¹¶
        merge(nums, i, m, j, t);
    }

    public void merge(int[] nums, int l, int m, int r, int[] t) {
        int p1 = l, p2 = m+1;
        int k = p1;
        while (p1 <= m && p2 <= r) {
            if (nums[p1] < nums[p2]) {
                t[k++] = nums[p1++];
            } else {
                t[k++] = nums[p2++];
            }
        }
        if (p1 <= m) {
            System.arraycopy(nums, p1, t, k, m - p1 + 1);
        } else {
            System.arraycopy(nums, p2, t, k, r - p2 + 1);
        }
        System.arraycopy(t, l, nums, l, r - l + 1);
    }
}
```





### éé€’å½’å®ç°ï¼šè‡ªåº•å‘ä¸Š

```
[5,1,1,2,0,0]
[5,1] [1,2] [0,0]   
[5,1,1,2] [0,0]     // è€Œè‡ªé¡¶å‘ä¸‹æ˜¯ [5,1,1] [2,0,0]
[5,1,1,2,0,0]   
```
```java
public int[] sortArray(int[] nums) {
    int[] t_arr = new int[nums.length];
    split(nums, t_arr);
    return nums;
}

public void split(int[] nums, int[] t_arr) {
    int length = nums.length;
    // å®½åº¦2ï¼Œä¸æ–­è†¨èƒ€ï¼Œç›´åˆ°ä¸€åŠèƒ½å®Œå…¨ç›–ä½æ•°ç»„å‰ï¼ˆè¦è®©å·¦å³è¿˜æœ‰çš„æ¯”è¾ƒï¼Œä¸èƒ½è®©å·¦è¾¹å–å®Œæ•°ç»„ï¼‰
    for (int width = 2; width / 2 < length; width *= 2) {
        for (int left = 0; left < length; left += width) {
            int right = left + width - 1;
            int m = Math.min((left + right) >>> 1, length - 1);
            right = Math.min(right, length - 1);
            merge(nums, left, m, m + 1, right, t_arr);
        }
        System.arraycopy(t_arr, 0, nums, 0, length);
    }
}

public void merge(int[] nums, int mLeft, int mRight, int nLeft, int nRight, int[] t_arr) {
    int k = mLeft;
    while (mLeft <= mRight && nLeft <= nRight) {
        if (nums[mLeft] < nums[nLeft]) {
            t_arr[k] = nums[mLeft];
            mLeft++;
        } else {
            t_arr[k] = nums[nLeft];
            nLeft++;
        }
        k++;
    }
    if (mLeft <= mRight) {
        System.arraycopy(nums, mLeft, t_arr, k, mRight - mLeft + 1);
    } else {
        System.arraycopy(nums, nLeft, t_arr, k, nRight - nLeft + 1);
    }
}
```

### é€’å½’å®ç°+å…ƒç´ å°‘æ—¶æ’å…¥æ’åº

å…ƒç´ å°‘æ—¶æ’å…¥æ’åºï¼Œæ˜¯åœ¨åˆ†è£‚ä¸­ï¼Œè€Œä¸æ˜¯ä¸€å¼€å§‹åˆ¤æ–­æ•°ç»„ç”¨å½’å¹¶è¿˜æ˜¯åˆ†è£‚ã€‚

```java
class Solution {
    public int[] sortArray(int[] nums) {
        int[] t_arr = new int[nums.length];
        split(nums, 0, nums.length - 1, t_arr);
        return nums;
    }

    public void insertion(int[] nums, int left, int right){
        for(int low = left + 1; low <= right; low++){
            int t = nums[low];
            int i = low - 1;
            while(i >= left && nums[i] > t){
                nums[i + 1] = nums[i];
                i--;
            }
            if(i != low -1){
                nums[i + 1] = t;
            }
        }
    }

    public void split(int[] nums, int left, int right, int[] t_arr) {
        if (left == right) {
            return;
        }
        else if (right - left <= 32) {
            insertion(nums, left, right);
            return;
        }
        // åˆ†
        int m = (left + right) >>> 1;
        split(nums, left, m, t_arr);
        split(nums, m + 1, right, t_arr);
        // å¹¶ï¼šç»“æœå­˜åˆ°ä¸´æ—¶æ•°ç»„é‡Œ
        merge(nums, left, m, m + 1, right, t_arr);
        // å°†ä¸´æ—¶æ•°ç»„é‡Œçš„ç»“æœæ‹·å›åŸæ•°ç»„
        System.arraycopy(t_arr, left, nums, left, right - left + 1);
    }

    public void merge(int[] nums, int mLeft, int mRight, int nLeft, int nRight, int[] t_arr) {
        int k = mLeft;
        while (mLeft <= mRight && nLeft <= nRight) {
            if (nums[mLeft] < nums[nLeft]) {
                t_arr[k] = nums[mLeft];
                mLeft++;
            } else {
                t_arr[k] = nums[nLeft];
                nLeft++;
            }
            k++;
        }
        if (mLeft <= mRight) {
            System.arraycopy(nums, mLeft, t_arr, k, mRight - mLeft + 1);
        } else {
            System.arraycopy(nums, nLeft, t_arr, k, nRight - nLeft + 1);
        }
    }

    public void swap(int[] nums, int i, int j) {
        nums[i] = nums[i] ^ nums[j];
        nums[j] = nums[i] ^ nums[j];
        nums[i] = nums[i] ^ nums[j];
    }
}
```

## ç®—æ³•ç‰¹æ€§

**æ—¶é—´å¤æ‚åº¦ä¸º $O(n \log n)$ã€éè‡ªé€‚åº”æ’åº**ï¼š

â€‹	åˆ’åˆ†äº§ç”Ÿé«˜åº¦ä¸º $\log n$ çš„é€’å½’æ ‘ï¼Œæ¯å±‚åˆå¹¶çš„æ€»æ“ä½œæ•°é‡ä¸º $n$ ï¼Œå› æ­¤æ€»ä½“æ—¶é—´å¤æ‚åº¦ä¸º $O(n \log n)$ 

â€‹	ç”±ä¸»å®šç†è®¡ç®—ä¹Ÿå¯å¾—åˆ° T(n) = 2T(n/2) + O(n) â†’   $O(n \log n)$

**ç©ºé—´å¤æ‚åº¦ä¸º $O(n)$ã€éåŸåœ°æ’åº**ï¼š

â€‹	é€’å½’æ·±åº¦ä¸º $\log n$ ï¼Œä½¿ç”¨ $O(\log n)$ å¤§å°çš„æ ˆå¸§ç©ºé—´ã€‚

â€‹	åˆå¹¶æ“ä½œéœ€è¦å€ŸåŠ©è¾…åŠ©æ•°ç»„å®ç°ï¼Œä½¿ç”¨ $O(n)$ å¤§å°çš„é¢å¤–ç©ºé—´ã€‚

**ç¨³å®šæ’åº**ï¼šåœ¨åˆå¹¶è¿‡ç¨‹ä¸­ï¼Œç›¸ç­‰å…ƒç´ çš„æ¬¡åºä¿æŒä¸å˜ã€‚

